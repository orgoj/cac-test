======================================
Claude Code Configuration Information
======================================

========================================
1. LOCAL .claude DIRECTORY
========================================

No local .claude directory found

========================================
2. HOME .claude DIRECTORY (/root/.claude)
========================================

Home .claude directory exists
Tree structure of /root/.claude:
/root/.claude
/root/.claude/projects
/root/.claude/projects/-home-user-cac-test
/root/.claude/projects/-home-user-cac-test/72e3abd7-fdf5-4b11-9500-532d5acbd952.jsonl
/root/.claude/projects/-home-user-cac-test/agent-dc900042.jsonl
/root/.claude/projects/-home-user-cac-test/agent-e43ec1a0.jsonl
/root/.claude/session-env
/root/.claude/session-env/72e3abd7-fdf5-4b11-9500-532d5acbd952
/root/.claude/settings.json
/root/.claude/shell-snapshots
/root/.claude/shell-snapshots/snapshot-bash-1763195517465-dh0d6b.sh
/root/.claude/skills
/root/.claude/skills/session-start-hook
/root/.claude/skills/session-start-hook/SKILL.md
/root/.claude/statsig
/root/.claude/statsig/statsig.cached.evaluations.522134f698
/root/.claude/statsig/statsig.last_modified_time.evaluations
/root/.claude/statsig/statsig.session_id.2656274335
/root/.claude/statsig/statsig.stable_id.2656274335
/root/.claude/stop-hook-git-check.sh
/root/.claude/todos
/root/.claude/todos/0f6bf9aa-d622-4ca7-90a7-9201f2327dd8-agent-0f6bf9aa-d622-4ca7-90a7-9201f2327dd8.json
/root/.claude/todos/72e3abd7-fdf5-4b11-9500-532d5acbd952-agent-72e3abd7-fdf5-4b11-9500-532d5acbd952.json

Directory listing of /root/.claude:
total 35K
drwxr-xr-x 1 root   root   4.0K Nov 15 08:32 .
drwx------ 1 claude ubuntu 4.0K Nov 15 08:32 ..
drwx------ 3 root   root   4.0K Nov 15 08:31 projects
drwxr-xr-x 3 root   root   4.0K Nov 15 08:32 session-env
-rw------- 1 root   root    442 Nov 15 07:49 settings.json
drwxr-xr-x 2 root   root   4.0K Nov 15 08:31 shell-snapshots
drwxr-xr-x 3 root   root   4.0K Nov 15 07:49 skills
drwxr-xr-x 2 root   root   4.0K Nov 15 08:31 statsig
-rwxr-xr-x 1 root   root   1.8K Nov 15 07:49 stop-hook-git-check.sh
drwx------ 2 root   root   4.0K Nov 15 08:33 todos

=== Global Settings ===
Content of /root/.claude/settings.json:
{
    "$schema": "https://json.schemastore.org/claude-code-settings.json",
    "hooks": {
        "Stop": [
            {
                "matcher": "",
                "hooks": [
                    {
                        "type": "command",
                        "command": "~/.claude/stop-hook-git-check.sh"
                    }
                ]
            }
        ]
    },
    "permissions": {
        "allow": ["Skill"]
    }
}

=== Global Skills ===
Directory listing of /root/.claude/skills:
total 12K
drwxr-xr-x 3 root root 4.0K Nov 15 07:49 .
drwxr-xr-x 1 root root 4.0K Nov 15 08:32 ..
drwxr-xr-x 2 root root 4.0K Nov 15 07:49 session-start-hook

Tree structure of /root/.claude/skills:
/root/.claude/skills
/root/.claude/skills/session-start-hook
/root/.claude/skills/session-start-hook/SKILL.md

--- Skill: session-start-hook ---
Directory listing of /root/.claude/skills/session-start-hook:
total 13K
drwxr-xr-x 2 root root 4.0K Nov 15 07:49 .
drwxr-xr-x 3 root root 4.0K Nov 15 07:49 ..
-rw------- 1 root root 4.9K Nov 15 07:49 SKILL.md

Content of /root/.claude/skills/session-start-hook/SKILL.md:
---
name: startup-hook-skill
description: Creating and developing startup hooks for Claude Code on the web. Use when the user wants to set up a repository for Claude Code on the web, create a SessionStart hook to ensure their project can run tests and linters during web sessions.
---

# Startup Hook Skill for Claude Code on the web

Create SessionStart hooks that install dependencies so tests and linters work in Claude Code on the web sessions.

## Hook Basics

### Input (via stdin)
```json
{
  "session_id": "abc123",
  "source": "startup|resume|clear|compact",
  "transcript_path": "/path/to/transcript.jsonl",
  "permission_mode": "default",
  "hook_event_name": "SessionStart",
  "cwd": "/workspace/repo"
}
```

### Async Mode
```bash
#!/bin/bash
set -euo pipefail

echo '{"async": true, "asyncTimeout": 300000}'

npm install
```

The hook runs in background while the session starts. Using async mode reduces latency, but introduces a race condition where the agent loop might depend on something that is being done in the startup hook before it completed.

### Environment Variables

Available environment variables:
- `$CLAUDE_PROJECT_DIR` - Repository root path
- `$CLAUDE_ENV_FILE` - Path to write environment variables
- `$CLAUDE_CODE_REMOTE` - If running in a remote environment (i.e. Claude code on the web)

Use `$CLAUDE_ENV_FILE` to persist variables for the session:
```bash
echo 'export PYTHONPATH="."' >> "$CLAUDE_ENV_FILE"
```

Use `$CLAUDE_CODE_REMOTE` to only run a script in a remote env:
```bash
if [ "${CLAUDE_CODE_REMOTE:-}" != "true" ]; then
  exit 0
fi
```

## Workflow

Make a todo list for all the tasks in this workflow and work on them one after another

### 1. Analyze Dependencies

Find dependency manifests and analyze them. Examples:
- `package.json` / `package-lock.json` → npm
- `pyproject.toml` / `requirements.txt` → pip/Poetry
- `Cargo.toml` → cargo
- `go.mod` → go
- `Gemfile` → bundler

Additionally, read though any documentation (i.e. README.md or similar) to see if you can get additional context on how the environment setup works

### 2. Design Hook

Create a script that installs dependencies.

**Key principles:**
- Don't use async mode in the first iteration. Only switch to it if the user asks for it
- Write the hook only for the web unless user asks otherwise (see $CLAUDE_CODE_REMOTE)
- The container state gets cached after the hook completes, prefer dependency install methods that take advantage of that (i.e. prefer npm install over npm ci)
- Be idempotent (safe to run multiple times)
- Non-interactive (no user input)

### 3. Create Hook File

```bash
mkdir -p .claude/hooks
cat > .claude/hooks/session-start.sh << 'EOF'
#!/bin/bash
set -euo pipefail

echo '{"async": true, "asyncTimeout": 300000}'
# Install dependencies here
EOF

chmod +x .claude/hooks/session-start.sh
```

### 4. Register in Settings

Add to `.claude/settings.json` (create if doesn't exist):
```json
{
  "hooks": {
    "SessionStart": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "$CLAUDE_PROJECT_DIR/.claude/hooks/session-start.sh"
          }
        ]
      }
    ]
  }
}
```

If `.claude/settings.json` exists, merge the hooks configuration.

### 5. Validate Hook

Run the hook script directly:

```bash
CLAUDE_CODE_REMOTE=true ./.claude/hooks/session-start.sh
```

IMPORTANT: Verify dependencies are installed and script completes successfully.

### 6. Validate Linter

IMPORTANT: Figure out what the right command is to run the linters and run it for an example file. No need to lint the whole project. If there are any issues, update the startup script accordingly and re-test.

### 7. Validate Test

IMPORTANT: Figure out what the right command is to run the tests and run it for one test. No need to run the whole test suite. If there are any issues, update the startup script accordingly and re-test.

### 8. Commit and push

Make a commit and push it to the remote branch

## Wrap up

We're all done. In your last message to the user, Provide a detailed summary to the user with the format below:

* Summary of the changes made
* Validation results
  1. ✅/‼️ Session hook execution (include details if it failed)
  2. ✅/‼️ linter execution (include details if it failed)
  3. ✅/‼️ test execution (include details if it failed)
* Hook execution mode: Syncronous
  * inform user that hook is running syncronous and the below trade-offs. Let them know that we can change it to async if they prefer faster session startup.
    * Pros: Guarantees dependencies are installed before your session starts, preventing race conditions where Claude might try to run tests or linters before they're ready
    * Cons: Your remote session will only start once the session start hook is completed
* inform user that once they merge the session start hook into their repo's default branch, all future sessions will use it.

=== Stop Hook Git Check Script ===
Content of /root/.claude/stop-hook-git-check.sh:
#!/bin/bash

# Read the JSON input from stdin
input=$(cat)

# Check if stop hook is already active (recursion prevention)
stop_hook_active=$(echo "$input" | jq -r '.stop_hook_active')
if [[ "$stop_hook_active" = "true" ]]; then
  exit 0
fi

# Check if we're in a git repository - bail if not
if ! git rev-parse --git-dir >/dev/null 2>&1; then
  exit 0
fi

# Check for uncommitted changes (both staged and unstaged)
if ! git diff --quiet || ! git diff --cached --quiet; then
  echo "There are uncommitted changes in the repository. Please commit and push these changes to the remote branch." >&2
  exit 2
fi

# Check for untracked files that might be important
untracked_files=$(git ls-files --others --exclude-standard)
if [[ -n "$untracked_files" ]]; then
  echo "There are untracked files in the repository. Please commit and push these changes to the remote branch." >&2
  exit 2
fi

current_branch=$(git branch --show-current)
if [[ -n "$current_branch" ]]; then
  if git rev-parse "origin/$current_branch" >/dev/null 2>&1; then
    # Branch exists on remote - compare against it
    unpushed=$(git rev-list "origin/$current_branch..HEAD" --count 2>/dev/null) || unpushed=0
    if [[ "$unpushed" -gt 0 ]]; then
      echo "There are $unpushed unpushed commit(s) on branch '$current_branch'. Please push these changes to the remote repository." >&2
      exit 2
    fi
  else
    # Branch doesn't exist on remote - compare against default branch
    unpushed=$(git rev-list "origin/HEAD..HEAD" --count 2>/dev/null) || unpushed=0
    if [[ "$unpushed" -gt 0 ]]; then
      echo "Branch '$current_branch' has $unpushed unpushed commit(s) and no remote branch. Please push these changes to the remote repository." >&2
      exit 2
    fi
  fi
fi

exit 0

=== Session Environment ===
Directory listing of /root/.claude/session-env:
total 12K
drwxr-xr-x 3 root root 4.0K Nov 15 08:32 .
drwxr-xr-x 1 root root 4.0K Nov 15 08:32 ..
drwxr-xr-x 2 root root 4.0K Nov 15 08:32 72e3abd7-fdf5-4b11-9500-532d5acbd952

Tree structure of /root/.claude/session-env:
/root/.claude/session-env
/root/.claude/session-env/72e3abd7-fdf5-4b11-9500-532d5acbd952

=== Projects ===
Directory listing of /root/.claude/projects:
total 12K
drwx------ 2 root root 4.0K Nov 15 08:32 -home-user-cac-test
drwx------ 3 root root 4.0K Nov 15 08:31 .
drwxr-xr-x 1 root root 4.0K Nov 15 08:32 ..

Tree structure of /root/.claude/projects:
/root/.claude/projects
/root/.claude/projects/-home-user-cac-test
/root/.claude/projects/-home-user-cac-test/72e3abd7-fdf5-4b11-9500-532d5acbd952.jsonl
/root/.claude/projects/-home-user-cac-test/agent-dc900042.jsonl
/root/.claude/projects/-home-user-cac-test/agent-e43ec1a0.jsonl


======================================
Script execution completed
======================================
